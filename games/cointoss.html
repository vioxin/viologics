<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-width=1.0">
  <title>ã‚³ã‚¤ãƒ³ãƒˆã‚¹ - ã‚‚ã£ã¡ã‚«ã‚¸ãƒ</title>
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f4f7f6; color: #333; text-align: center; padding: 20px; }
    .container { max-width: 500px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h2 { color: #2c3e50; }
    .status-box { background: #fcf3cf; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    .points { font-size: 1.5em; font-weight: bold; color: #e74c3c; }
    .btn-omote { background-color: #e74c3c; color: white; border: none; padding: 15px 30px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.2em; margin: 10px; transition: 0.3s; }
    .btn-omote:hover { background-color: #c0392b; }
    .btn-ura { background-color: #3498db; color: white; border: none; padding: 15px 30px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.2em; margin: 10px; transition: 0.3s; }
    .btn-ura:hover { background-color: #2980b9; }
    button:disabled { background-color: #bdc3c7 !important; cursor: not-allowed; }
    #result-area { margin-top: 20px; padding: 15px; font-weight: bold; font-size: 1.3em; border-radius: 5px; display: none; }
    .link { display: inline-block; margin-top: 30px; color: #7f8c8d; text-decoration: none; border: 1px solid #7f8c8d; padding: 10px 20px; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸª™ ã‚³ã‚¤ãƒ³ãƒˆã‚¹</h2>
    <p>å‚åŠ è²»: 100 ã‚‚ã£ã¡ / å‹åˆ©å ±é…¬: 200 ã‚‚ã£ã¡</p>
    
    <div class="status-box">
      <p style="margin: 0;">ã‚ãªãŸã®æ‰€æŒã‚‚ã£ã¡</p>
      <p class="points"><span id="display-points">---</span> ã‚‚ã£ã¡</p>
    </div>

    <div id="game-area">
      <p>è¡¨ã‹è£ã‹ã€ã©ã¡ã‚‰ã«è³­ã‘ã¾ã™ã‹ï¼Ÿ</p>
      <button id="btn-omote" class="btn-omote" onclick="playGame('è¡¨')">è¡¨ã«è³­ã‘ã‚‹</button>
      <button id="btn-ura" class="btn-ura" onclick="playGame('è£')">è£ã«è³­ã‘ã‚‹</button>
    </div>

    <div id="result-area"></div>

    <a href="../index.html" class="link">ğŸ”™ ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
  </div>

  <script>
    // â˜…å¿…ãšæ­£ã—ã„ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLï¼ˆ/exec ã§çµ‚ã‚ã‚‹ã‚‚ã®ï¼‰ã«æ›¸ãæ›ãˆã¦ãã ã•ã„
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyOmbY7H3r9MIDMsH4m7BifWwIknowmiE9nD44wXZVFrffQYOPr_OSvaejnyQvAdVtZNw/exec";
    const COST = 100;
    const REWARD = 200;
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ‰€æŒãƒã‚¤ãƒ³ãƒˆã‚’è¡¨ç¤º
    let currentPoints = parseInt(localStorage.getItem('userPoints'));
    document.getElementById('display-points').innerText = currentPoints;

    async function playGame(bet) {
      if (currentPoints < COST) {
        alert("ã‚‚ã£ã¡ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
        return;
      }

      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦é€£æ‰“é˜²æ­¢ï¼†ã€Œé€šä¿¡ä¸­ã€ã®ã‚¢ãƒ”ãƒ¼ãƒ«
      const btnOmote = document.getElementById('btn-omote');
      const btnUra = document.getElementById('btn-ura');
      btnOmote.disabled = true;
      btnUra.disabled = true;
      
      const resultArea = document.getElementById('result-area');
      resultArea.style.display = 'block';
      resultArea.style.backgroundColor = '#ecf0f1';
      resultArea.style.color = '#333';
      resultArea.innerText = "ã‚³ã‚¤ãƒ³ãƒˆã‚¹ä¸­... (ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨é€šä¿¡ä¸­)";

      // å‹æ•—ã®åˆ¤å®š
      const coins = ['è¡¨', 'è£'];
      const result = coins[Math.floor(Math.random() * coins.length)];
      
      // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
      currentPoints -= COST; // ã¾ãšå‚åŠ è²»ã‚’å¼•ã
      let isWin = (bet === result);
      if (isWin) {
        currentPoints += REWARD; // å‹ã£ãŸã‚‰å ±é…¬ã‚’è¶³ã™
      }

      try {
        // GAS(ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ)ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°ï¼ˆã“ã“ã§åŒæœŸï¼‰
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'updatePoints',
            id: localStorage.getItem('userId'),
            newPoints: currentPoints
          }),
          headers: { 'Content-Type': 'text/plain' }
        });
        
        const resData = await response.json();

        if(resData.success) {
          // é€šä¿¡æˆåŠŸæ™‚ï¼šçµæœã¨æœ€æ–°ã®ãƒã‚¤ãƒ³ãƒˆã‚’ç”»é¢ã«åæ˜ ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ã¨åŒç­‰ã®åŒæœŸï¼‰
          localStorage.setItem('userPoints', currentPoints);
          document.getElementById('display-points').innerText = currentPoints;

          if (isWin) {
            resultArea.style.backgroundColor = '#d5f5e3';
            resultArea.style.color = '#27ae60';
            resultArea.innerText = `çµæœã¯ã€Œ${result}ã€ï¼\nå¤§æ­£è§£ï¼ ${REWARD} ã‚‚ã£ã¡ç²å¾—ï¼`;
          } else {
            resultArea.style.backgroundColor = '#fadbd8';
            resultArea.style.color = '#c0392b';
            resultArea.innerText = `çµæœã¯ã€Œ${result}ã€...\næ®‹å¿µã€ãƒã‚ºãƒ¬ã§ã™ã€‚`;
          }
        } else {
          resultArea.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒã‚¤ãƒ³ãƒˆã¯æ¶ˆè²»ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        }
      } catch (e) {
        resultArea.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
      }

      // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã—ã¦æ¬¡ã®ã‚²ãƒ¼ãƒ ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
      btnOmote.disabled = false;
      btnUra.disabled = false;
    }
  </script>
</body>
</html>
