<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ - ã‚‚ã£ã¡ã‚«ã‚¸ãƒ</title>
  <style>
    body { font-family: sans-serif; background-color: #1a252f; color: white; text-align: center; padding: 20px; margin: 0; }
    .container { max-width: 500px; margin: 0 auto; background: #2c3e50; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 90%; box-sizing: border-box; }
    h2 { color: #f1c40f; margin-top: 0; }
    .points { font-size: 1.5em; font-weight: bold; color: #f1c40f; }

    .bet-area { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    input[type="number"] { padding: 10px; font-size: 1.2em; width: 120px; text-align: right; border-radius: 5px; border: none; }

    /* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‘¨ã‚Š */
    .roulette-container { position: relative; width: 250px; height: 250px; margin: 30px auto; }
    .pointer { width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #f1c40f; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); z-index: 10; filter: drop-shadow(0 3px 3px rgba(0,0,0,0.5)); }
    .wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid #bdc3c7; box-sizing: border-box; transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
    .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: #ecf0f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; color: #333; border: 4px solid #7f8c8d; box-shadow: inset 0 3px 5px rgba(0,0,0,0.3); z-index: 5; }

    /* ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .btn-red { background-color: #e74c3c; color: white; border: 2px solid #c0392b; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; transition: 0.1s; }
    .btn-black { background-color: #34495e; color: white; border: 2px solid #2c3e50; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; transition: 0.1s; }
    button:active { transform: scale(0.95); }
    button:disabled { background-color: #7f8c8d !important; border-color: #95a5a6 !important; cursor: not-allowed; transform: none; }
    
    #result-area { margin-top: 20px; padding: 15px; font-weight: bold; font-size: 1.2em; border-radius: 5px; min-height: 1.5em; background: rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ¡ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h2>
    <p>æ‰€æŒé‡‘: <span id="display-points" class="points">---</span> ã‚‚ã£ã¡</p>

    <div class="bet-area">
      è³­ã‘é‡‘: <input type="number" id="bet-amount" value="200" min="10" step="10"> ã‚‚ã£ã¡
    </div>

    <div class="roulette-container">
      <div class="pointer"></div>
      <div id="wheel" class="wheel"></div>
      <div id="wheel-center" class="wheel-center">?</div>
    </div>

    <div id="game-area">
      <button id="btn-red" class="btn-red" onclick="spin('red')">èµ¤ã«è³­ã‘ã‚‹ (2å€)</button>
      <button id="btn-black" class="btn-black" onclick="spin('black')">é»’ã«è³­ã‘ã‚‹ (2å€)</button>
      <p style="font-size: 0.8em; color: #bdc3c7;">â€»ã€Œ0 (ç·‘)ã€ãŒå‡ºãŸå ´åˆã¯ä¸¡æ–¹ãƒã‚ºãƒ¬ã¨ãªã‚Šã¾ã™</p>
    </div>

    <div id="result-area">è³­ã‘é‡‘ã‚’æ±ºã‚ã¦è‰²ã‚’é¸ã‚“ã§ãã ã•ã„</div>

    <br><a href="../index.html" style="color:#bdc3c7; text-decoration: none;">ğŸ”™ ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyOmbY7H3r9MIDMsH4m7BifWwIknowmiE9nD44wXZVFrffQYOPr_OSvaejnyQvAdVtZNw/exec"; // â˜…æ›¸ãæ›ãˆã¦ãã ã•ã„
    let currentPoints = parseInt(localStorage.getItem('userPoints'));
    document.getElementById('display-points').innerText = currentPoints;

    // ãƒ¨ãƒ¼ãƒ­ãƒ”ã‚¢ãƒ³ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®æ•°å­—ã®ä¸¦ã³é †ï¼ˆ0ã€œ36ï¼‰
    const order = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    const reds = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
    
    // å††ç›¤ã®è‰²åˆ†ã‘ã‚’å‹•çš„ã«ç”Ÿæˆ
    let gradientStr = [];
    const sliceAngle = 360 / 37;
    for(let i = 0; i < 37; i++) {
      let num = order[i];
      let color = (num === 0) ? '#27ae60' : (reds.includes(num) ? '#c0392b' : '#34495e');
      let startAngle = i * sliceAngle;
      let endAngle = (i + 1) * sliceAngle;
      gradientStr.push(`${color} ${startAngle}deg ${endAngle}deg`);
    }
    document.getElementById('wheel').style.background = `conic-gradient(from -${sliceAngle/2}deg, ${gradientStr.join(', ')})`;

    let currentRotation = 0;

    async function spin(betColor) {
      const betAmount = parseInt(document.getElementById('bet-amount').value);
      if (betAmount < 10 || currentPoints < betAmount) { alert("è³­ã‘é‡‘ãŒä¸æ­£ã‹ã€ã‚‚ã£ã¡ãŒè¶³ã‚Šã¾ã›ã‚“ï¼"); return; }

      // UIã‚’ãƒ­ãƒƒã‚¯
      document.getElementById('btn-red').disabled = true;
      document.getElementById('btn-black').disabled = true;
      const resultArea = document.getElementById('result-area');
      resultArea.innerText = "ã‚¹ãƒ”ãƒ³ä¸­...";
      resultArea.style.color = "white";

      // æ›ã‘é‡‘æ¶ˆè²»
      currentPoints -= betAmount;
      updateDisplay();

      // çµæœã®æŠ½é¸
      const resultIndex = Math.floor(Math.random() * 37);
      const resultNum = order[resultIndex];
      const resultIsRed = reds.includes(resultNum);
      const actualColor = (resultNum === 0) ? 'green' : (resultIsRed ? 'red' : 'black');

      // å›è»¢è§’åº¦ã®è¨ˆç®—ï¼ˆå¿…ãšé¸ã°ã‚ŒãŸæ•°å­—ãŒä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
      const extraSpins = 5; // 5å‘¨å›ã‚‹
      const targetAngle = 360 - (resultIndex * sliceAngle);
      const currentBase = currentRotation % 360;
      let angleDiff = targetAngle - currentBase;
      if (angleDiff < 0) angleDiff += 360; // å¸¸ã«æ™‚è¨ˆå›ã‚Š
      
      currentRotation += (360 * extraSpins) + angleDiff;
      document.getElementById('wheel').style.transform = `rotate(${currentRotation}deg)`;

      // ä¸­å¤®ã®æ•°å­—ãŒãƒ‘ãƒ©ãƒ‘ãƒ©å¤‰ã‚ã‚‹æ¼”å‡º
      const centerEl = document.getElementById('wheel-center');
      let rollInterval = setInterval(() => {
        centerEl.innerText = order[Math.floor(Math.random() * 37)];
      }, 50);

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼ˆ4ç§’ï¼‰ã‚’å¾…ã¤
      await new Promise(r => setTimeout(r, 4000));
      clearInterval(rollInterval);

      // çµæœè¡¨ç¤º
      centerEl.innerText = resultNum;
      centerEl.style.color = (actualColor === 'red') ? '#c0392b' : (actualColor === 'black' ? '#34495e' : '#27ae60');

      // å‹æ•—åˆ¤å®š
      let isWin = false;
      if (actualColor === betColor && resultNum !== 0) {
        isWin = true;
      }

      let colorText = (actualColor === 'red') ? 'ğŸ”´ èµ¤' : (actualColor === 'black' ? 'âš« é»’' : 'ğŸŸ¢ ç·‘(0)');
      
      if (isWin) {
        let reward = betAmount * 2;
        currentPoints += reward;
        resultArea.innerHTML = `çµæœ: ã€${resultNum}ã€‘ ${colorText}<br><span style="color:#2ecc71;">å¤§æ­£è§£ï¼ ${reward} ã‚‚ã£ã¡ç²å¾—ï¼</span>`;
      } else {
        resultArea.innerHTML = `çµæœ: ã€${resultNum}ã€‘ ${colorText}<br><span style="color:#e74c3c;">æ®‹å¿µã€ãƒã‚ºãƒ¬ã§ã™...</span>`;
      }

      await fetch(GAS_URL, {
        method: 'POST', body: JSON.stringify({ action: 'updatePoints', id: localStorage.getItem('userId'), newPoints: currentPoints }),
        headers: { 'Content-Type': 'text/plain' }
      });
      updateDisplay();

      // ãƒ­ãƒƒã‚¯è§£é™¤
      document.getElementById('btn-red').disabled = false;
      document.getElementById('btn-black').disabled = false;
    }

    function updateDisplay() {
      localStorage.setItem('userPoints', currentPoints);
      document.getElementById('display-points').innerText = currentPoints;
    }
  </script>
</body>
</html>
