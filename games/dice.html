<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Ç≥„Ç§„É≥„Éà„Çπ - „ÇÇ„Å£„Å°„Ç´„Ç∏„Éé</title>
  <style>
    body { font-family: sans-serif; background-color: #f4f7f6; color: #333; text-align: center; padding: 20px; margin: 0; }
    .container { max-width: 500px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 90%; box-sizing: border-box; }
    h2 { color: #2c3e50; }
    .status-box { background: #fcf3cf; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    .points { font-size: 1.5em; font-weight: bold; color: #e74c3c; }
    
    /* „Ç≥„Ç§„É≥„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî® */
    .coin-container { perspective: 1000px; margin: 30px auto; width: 100px; height: 100px; }
    .coin { width: 100%; height: 100%; font-size: 5em; line-height: 100px; border-radius: 50%; background: #f1c40f; color: #d35400; box-shadow: inset 0 0 15px #e67e22, 0 5px 15px rgba(0,0,0,0.3); transition: transform 2s cubic-bezier(0.25, 0.1, 0.25, 1); transform-style: preserve-3d; display: flex; align-items: center; justify-content: center; }
    
    .bet-area { background: #ecf0f1; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    input[type="number"] { padding: 10px; font-size: 1.2em; width: 120px; text-align: right; border-radius: 5px; border: 1px solid #bdc3c7; }
    .btn-omote { background-color: #e74c3c; color: white; border: none; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; }
    .btn-ura { background-color: #3498db; color: white; border: none; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; }
    button:disabled { background-color: #bdc3c7 !important; cursor: not-allowed; }
    #result-area { margin-top: 20px; padding: 15px; font-weight: bold; font-size: 1.2em; border-radius: 5px; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ü™ô „Ç≥„Ç§„É≥„Éà„Çπ</h2>
    
    <div class="status-box">
      <p style="margin: 0;">„ÅÇ„Å™„Åü„ÅÆÊâÄÊåÅ„ÇÇ„Å£„Å°</p>
      <p class="points"><span id="display-points">---</span> „ÇÇ„Å£„Å°</p>
    </div>

    <div class="bet-area">
      Ë≥≠„ÅëÈáë: <input type="number" id="bet-amount" value="100" min="10" step="10"> „ÇÇ„Å£„Å°
    </div>

    <div class="coin-container">
      <div id="coin" class="coin">Ôºü</div>
    </div>

    <div id="game-area">
      <button id="btn-omote" class="btn-omote" onclick="playGame('Ë°®')">Ë°®„Å´Ë≥≠„Åë„Çã</button>
      <button id="btn-ura" class="btn-ura" onclick="playGame('Ë£è')">Ë£è„Å´Ë≥≠„Åë„Çã</button>
    </div>

    <div id="result-area"></div>

    <br><a href="../index.html" style="color:#7f8c8d;">üîô „Éû„Ç§„Éö„Éº„Ç∏„Å´Êàª„Çã</a>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyOmbY7H3r9MIDMsH4m7BifWwIknowmiE9nD44wXZVFrffQYOPr_OSvaejnyQvAdVtZNw/exec";
    let currentPoints = parseInt(localStorage.getItem('userPoints'));
    document.getElementById('display-points').innerText = currentPoints;

    async function playGame(bet) {
      const betAmount = parseInt(document.getElementById('bet-amount').value);
      if (betAmount < 10 || currentPoints < betAmount) { alert("Ë≥≠„ÅëÈáë„Åå‰∏çÊ≠£„Åã„ÄÅ„ÇÇ„Å£„Å°„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ"); return; }

      document.getElementById('btn-omote').disabled = true;
      document.getElementById('btn-ura').disabled = true;
      
      const resultArea = document.getElementById('result-area');
      resultArea.style.display = 'block';
      resultArea.style.backgroundColor = '#ecf0f1';
      resultArea.style.color = '#333';
      resultArea.innerText = "„Ç≥„Ç§„É≥„Éà„Çπ‰∏≠...";

      currentPoints -= betAmount;
      updateDisplay();

      // „Ç≥„Ç§„É≥ÂõûËª¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ („É©„É≥„ÉÄ„É†„Å™ÂõûËª¢Êï∞„ÇíËøΩÂä†)
      const coin = document.getElementById('coin');
      const spins = Math.floor(Math.random() * 5) + 5; // 5„Äú9ÂõûËª¢
      const isOmoteResult = Math.random() < 0.5;
      const extraDegrees = isOmoteResult ? 0 : 180; 
      const totalRotation = (spins * 360) + extraDegrees;
      
      coin.style.transform = `rotateY(${totalRotation}deg)`;
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅåÁµÇ„Çè„Çã„Åæ„ÅßÂæÖÊ©üÔºà2ÁßíÔºâ
      await new Promise(r => setTimeout(r, 2000));

      const result = isOmoteResult ? 'Ë°®' : 'Ë£è';
      coin.innerText = result;
      coin.style.color = isOmoteResult ? '#e74c3c' : '#3498db';

      let isWin = (bet === result);
      let reward = isWin ? betAmount * 2 : 0;
      currentPoints += reward;

      if (isWin) {
        resultArea.style.backgroundColor = '#d5f5e3';
        resultArea.style.color = '#27ae60';
        resultArea.innerText = `Â§ßÊ≠£Ëß£ÔºÅ ${reward} „ÇÇ„Å£„Å°Áç≤ÂæóÔºÅ`;
      } else {
        resultArea.style.backgroundColor = '#fadbd8';
        resultArea.style.color = '#c0392b';
        resultArea.innerText = `ÊÆãÂøµ„ÄÅ„Éè„Ç∫„É¨„Åß„Åô„ÄÇ`;
      }

      await fetch(GAS_URL, {
        method: 'POST', body: JSON.stringify({ action: 'updatePoints', id: localStorage.getItem('userId'), newPoints: currentPoints }),
        headers: { 'Content-Type': 'text/plain' }
      });
      updateDisplay();

      document.getElementById('btn-omote').disabled = false;
      document.getElementById('btn-ura').disabled = false;
    }

    function updateDisplay() {
      localStorage.setItem('userPoints', currentPoints);
      document.getElementById('display-points').innerText = currentPoints;
    }
  </script>
</body>
</html>
