<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚µã‚¤ã‚³ãƒ­ - ã‚‚ã£ã¡ã‚«ã‚¸ãƒ</title>
  <style>
    body { font-family: sans-serif; background-color: #2c3e50; color: white; text-align: center; padding: 20px; margin: 0; }
    .container { max-width: 500px; margin: 0 auto; background: #34495e; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 90%; box-sizing: border-box; }
    .points { font-size: 1.5em; font-weight: bold; color: #f1c40f; }
    
    /* ã‚µã‚¤ã‚³ãƒ­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š */
    .dice-container { margin: 30px auto; height: 120px; display: flex; justify-content: center; align-items: center; }
    .dice { font-size: 6em; line-height: 1; color: #ecf0f1; text-shadow: 2px 5px 10px rgba(0,0,0,0.5); display: inline-block; }
    .rolling { animation: shake 0.1s infinite; color: #f1c40f; }
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      25% { transform: translate(-1px, -2px) rotate(-5deg); }
      50% { transform: translate(-3px, 0px) rotate(5deg); }
      75% { transform: translate(3px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -1px) rotate(-5deg); }
    }

    .bet-area { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    input[type="number"] { padding: 10px; font-size: 1.2em; width: 120px; text-align: right; border-radius: 5px; border: none; }
    
    .btn-high { background-color: #e74c3c; color: white; border: none; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; }
    .btn-low { background-color: #3498db; color: white; border: none; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 1.1em; margin: 5px; width: 45%; }
    button:disabled { background-color: #7f8c8d !important; cursor: not-allowed; }
    #result-area { margin-top: 20px; padding: 15px; font-weight: bold; font-size: 1.2em; border-radius: 5px; min-height: 1.5em; background: rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ² ã‚µã‚¤ã‚³ãƒ­ (High & Low)</h2>
    <p>æ‰€æŒé‡‘: <span id="display-points" class="points">---</span> ã‚‚ã£ã¡</p>

    <div class="bet-area">
      è³­ã‘é‡‘: <input type="number" id="bet-amount" value="100" min="10" step="10"> ã‚‚ã£ã¡
    </div>

    <div class="dice-container">
      <div id="dice" class="dice">âš€</div>
    </div>

    <div id="game-area">
      <button id="btn-low" class="btn-low" onclick="playDice('low')">Low (1ã€œ3)</button>
      <button id="btn-high" class="btn-high" onclick="playDice('high')">High (4ã€œ6)</button>
    </div>

    <div id="result-area">è³­ã‘é‡‘ã‚’æ±ºã‚ã¦äºˆæƒ³ã‚’é¸ã‚“ã§ãã ã•ã„</div>

    <br><a href="../index.html" style="color:#bdc3c7;">ğŸ”™ ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyOmbY7H3r9MIDMsH4m7BifWwIknowmiE9nD44wXZVFrffQYOPr_OSvaejnyQvAdVtZNw/exec";
    let currentPoints = parseInt(localStorage.getItem('userPoints'));
    document.getElementById('display-points').innerText = currentPoints;
    const diceFaces = ['âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];

    async function playDice(guess) {
      const betAmount = parseInt(document.getElementById('bet-amount').value);
      if (betAmount < 10 || currentPoints < betAmount) { alert("è³­ã‘é‡‘ãŒä¸æ­£ã‹ã€ã‚‚ã£ã¡ãŒè¶³ã‚Šã¾ã›ã‚“ï¼"); return; }

      document.getElementById('btn-low').disabled = true;
      document.getElementById('btn-high').disabled = true;
      const resultArea = document.getElementById('result-area');
      resultArea.innerText = "ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ã¦ã„ã¾ã™...";
      resultArea.style.color = "white";

      currentPoints -= betAmount;
      updateDisplay();

      const diceEl = document.getElementById('dice');
      diceEl.classList.add('rolling');

      // ç›®ãŒé«˜é€Ÿã§åˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      let rollInterval = setInterval(() => {
        diceEl.innerText = diceFaces[Math.floor(Math.random() * 6)];
      }, 50);

      await new Promise(r => setTimeout(r, 1500)); // 1.5ç§’å›ã™

      clearInterval(rollInterval);
      diceEl.classList.remove('rolling');

      // çµæœã‚’æ±ºå®š
      const resultNum = Math.floor(Math.random() * 6) + 1;
      diceEl.innerText = diceFaces[resultNum - 1];
      
      const isHigh = resultNum >= 4;
      const resultType = isHigh ? 'high' : 'low';
      const isWin = (guess === resultType);

      if (isWin) {
        let reward = betAmount * 2;
        currentPoints += reward;
        resultArea.innerText = `ã€${resultNum}ã€‘ å¤§æ­£è§£ï¼ ${reward} ã‚‚ã£ã¡ç²å¾—ï¼`;
        resultArea.style.color = "#2ecc71";
      } else {
        resultArea.innerText = `ã€${resultNum}ã€‘ æ®‹å¿µã€ãƒã‚ºãƒ¬ã§ã™ã€‚`;
        resultArea.style.color = "#e74c3c";
      }

      await fetch(GAS_URL, {
        method: 'POST', body: JSON.stringify({ action: 'updatePoints', id: localStorage.getItem('userId'), newPoints: currentPoints }),
        headers: { 'Content-Type': 'text/plain' }
      });
      updateDisplay();

      document.getElementById('btn-low').disabled = false;
      document.getElementById('btn-high').disabled = false;
    }

    function updateDisplay() {
      localStorage.setItem('userPoints', currentPoints);
      document.getElementById('display-points').innerText = currentPoints;
    }
  </script>
</body>
</html>
